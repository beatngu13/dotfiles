# Home variables.
export ANT_HOME='/opt/Ant/apache-ant-1.9.6'
export JAVA_1_6_HOME='/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home'
export RETEST_ROOT_PATH='/opt/retest'
export RETEST_NIGHTLY_LATEST_PATH=${RETEST_ROOT_PATH}'/retest-demo-nightly-latest'
export RETEST_NIGHTLY_LATEST_ZIP='retest-demo-nightly-latest.zip'
export RETEST_BETA_LATEST_PATH=${RETEST_ROOT_PATH}'/retest-demo-beta-latest'
export RETEST_BETA_LATEST_ZIP='retest-demo-beta-latest.zip'
export RETEST_STABLE_LATEST_PATH=${RETEST_ROOT_PATH}'/retest-demo-stable-latest'
export RETEST_STABLE_LATEST_ZIP='retest-demo-stable-latest.zip'
export VAGRANT_SERVER_URL="http://192.168.178.51/boxes"

export PATH=\
${PATH}/bin:\
${ANT_HOME}/bin:\
${JAVA_1_6_HOME}/bin:\
${RETEST_ROOT_PATH}:\
${RETEST_NIGHTLY_LATEST_PATH}:\
${RETEST_NIGHTLY_LATEST_ZIP}:\
${RETEST_BETA_LATEST_PATH}:\
${RETEST_BETA_LATEST_ZIP}:\
${RETEST_STABLE_LATEST_PATH}:\
${RETEST_STABLE_LATEST_ZIP}:\
${VAGRANT_SERVER_URL}

# Quick start.
function rt() {
    if [ $1 == "nightly" ]
    then
        version=${RETEST_NIGHTLY_LATEST_PATH}
    elif [ $1 == "beta" ]
    then
        version=${RETEST_BETA_LATEST_PATH}
    elif [ $1 == "stable" ]
    then
        version=${RETEST_STABLE_LATEST_PATH}
    fi

    echo "Launching retest version:" $(cat ${version}/retest/version.txt) "..."
    sh ${version}/retest/retest-gui.sh
}

# Fast build.
function rtbuild() {
    echo "Executing clean install (offline without tests, obfuscation, license download, and info logs) ..."
    mvn clean install -o -DskipTests -Dproguard.skip=true -Dlicense.skipDownloadLicenses=true | grep -v "^\[INFO"
}

# Reset retest installations.
function rtreset() {
    cd ${RETEST_ROOT_PATH}

    reset() {
        rm -rf $2/*
        unzip -o -q $1 -d $2
    }

    echo "Resetting nightly ..."
    reset ${RETEST_NIGHTLY_LATEST_ZIP} ${RETEST_NIGHTLY_LATEST_PATH}

    echo "Resetting beta ..."
    reset ${RETEST_BETA_LATEST_ZIP} ${RETEST_BETA_LATEST_PATH}

    echo "Resetting stable ..."
    reset ${RETEST_STABLE_LATEST_ZIP} ${RETEST_STABLE_LATEST_PATH}

    cd -
}

# Update retest installations.
function rtup() {
    read -s -p "username:password? " credentials
    cd ${RETEST_ROOT_PATH}

    update() {
        rm $1
        curl --remote-name --user $credentials https://retest.de/update/$1
        rm -rf $2/*
        unzip -o -q $1 -d $2
    }

    echo "Updating nightly ..."
    update ${RETEST_NIGHTLY_LATEST_ZIP} ${RETEST_NIGHTLY_LATEST_PATH}

    echo "Updating beta ..."
    update ${RETEST_BETA_LATEST_ZIP} ${RETEST_BETA_LATEST_PATH}

    echo "Updating stable ..."
    update ${RETEST_STABLE_LATEST_ZIP} ${RETEST_STABLE_LATEST_PATH}

    cd -
}
